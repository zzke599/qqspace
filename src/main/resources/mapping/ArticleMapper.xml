<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qqspace.dao.ArticleMapper">
  <resultMap id="BaseResultMap" type="com.qqspace.bean.Article">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 17 13:36:21 CST 2019.
    -->
    <id column="article_Id" jdbcType="INTEGER" property="articleId" />
    <result column="article_title" jdbcType="VARCHAR" property="articleTitle" />
    <result column="article_image" jdbcType="VARCHAR" property="articleImage" />
    <result column="article_intro" jdbcType="VARCHAR" property="articleIntro" />
    <result column="article_author" jdbcType="VARCHAR" property="articleAuthor" />
    <result column="article_accessRight" jdbcType="INTEGER" property="articleAccessright" />
    <result column="article_push" jdbcType="INTEGER" property="articlePush" />
    <result column="article_examine" jdbcType="INTEGER" property="articleExamine" />
    <result column="article_labelId" jdbcType="INTEGER" property="articleLabelid" />
    <result column="article_userId" jdbcType="INTEGER" property="articleUserid" />
    <result column="article_createDate" jdbcType="TIMESTAMP" property="articleCreatedate" />
    <result column="label_name" jdbcType="VARCHAR" property="articleLabeName" />
    <result column="hi_count" jdbcType="INTEGER" property="hiCount" />
   
  </resultMap>
  <resultMap extends="BaseResultMap" id="ResultMapWithBLOBs" type="com.qqspace.bean.Article">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 17 13:36:21 CST 2019.
    -->
    <result column="article_content" jdbcType="LONGVARCHAR" property="articleContent" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 17 13:36:21 CST 2019.
    -->
    article_Id, article_title, article_image, article_intro, article_author, article_accessRight, 
    article_push, article_examine, article_labelId, article_userId, article_createDate
  </sql>
  <sql id="Blob_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 17 13:36:21 CST 2019.
    -->
    article_content
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="ResultMapWithBLOBs">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 17 13:36:21 CST 2019.
    -->
    select 
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />
    from article_info
    where article_Id = #{articleId,jdbcType=INTEGER} 
  </select>
  
   <select id="selectByLabelid" parameterType="java.lang.Integer" resultMap="ResultMapWithBLOBs">    
    select 
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />
    from article_info
    where article_labelId = #{articleLabelid,jdbcType=INTEGER} 
  </select>
  
  <select id="selectByAidAndUid"  resultMap="ResultMapWithBLOBs">    
    select 
    <include refid="Base_Column_List" />
    ,
    <include refid="Blob_Column_List" />
    from	 article_info
    where	 article_Id = #{articleId,jdbcType=INTEGER}
    and    article_userId = #{articleUserid,jdbcType=INTEGER}
  
  </select>
  <select id="selectByArticleCount"  parameterType="java.lang.Integer"  resultType="integer">    
    SELECT
    	 count(*)
    FROM article_info  
    WHERE article_userId in (SELECT fo_beUserid FROM follow_info WHERE fo_userid =  #{userid,jdbcType=INTEGER}  and article_accessRight = 2) 
    OR article_accessRight = 1 
     OR article_userId =  #{userid,jdbcType=INTEGER}
  </select>
  <select id="selectByArticleUserid"    resultMap="ResultMapWithBLOBs">    
    select
    <include refid="Base_Column_List" /> ,label_name
    from	 article_info
    LEFT JOIN label_info ON article_labelId = label_id  
    where	 article_userId in
    			(SELECT fo_beUserid FROM follow_info WHERE article_accessRight = 2 and  fo_userid = #{userid,jdbcType=INTEGER})
    OR article_userId = #{userid,jdbcType=INTEGER}
    OR article_accessRight = 1
    GROUP BY article_Id 
    ORDER BY article_createDate DESC
    LIMIT #{begin,jdbcType=INTEGER},#{recordSize,jdbcType=INTEGER} 
    
  </select>
  <select id="selectAllCountByUserid"    parameterType="java.lang.Integer"  resultType="integer" >    
    select  count(0)
    from	 article_info
    LEFT JOIN label_info ON article_labelId = label_id  
    where 1=1 and
    <if test="labelId != null">
        article_labelId = #{labelId,jdbcType=VARCHAR} and 
      </if> 	
    article_userId = #{userid,jdbcType=INTEGER} 
  </select>
  <select id="selectAllByUserid"    resultMap="ResultMapWithBLOBs">    
    select  <include refid="Base_Column_List" />, label_name
    from	 article_info
    LEFT JOIN label_info ON article_labelId = label_id
    where 1 =  1 and
    <if test="labelId != null">
        article_labelId = #{labelId,jdbcType=VARCHAR} and
    </if>
    	article_userId = #{userid,jdbcType=INTEGER} 
    
    ORDER BY article_createDate DESC
    LIMIT #{begin,jdbcType=INTEGER},#{recordSize,jdbcType=INTEGER} 
  </select>
   <select id="selectArticleTOPTwelveByUserId" parameterType="java.lang.Integer"   resultMap="ResultMapWithBLOBs">
    SELECT <include refid="Base_Column_List" />, hi_count, label_name
	FROM article_info 
	LEFT JOIN hitscount_info ON article_Id = hi_articleId 
	LEFT JOIN label_info ON article_labelId = label_id  
	WHERE 
	article_userId IN (SELECT fo_beUserid FROM follow_info WHERE fo_userid = #{articleUserid} ) AND article_accessRight = 2 AND DATE_SUB(CURDATE(), INTERVAL 30 DAY) &lt;= article_createDate  
	OR article_accessRight =1 AND DATE_SUB(CURDATE(), INTERVAL 30 DAY) &lt;= article_createDate 
	OR article_userId =#{articleUserid} AND DATE_SUB(CURDATE(), INTERVAL 30 DAY) &lt;= article_createDate 
	GROUP BY article_Id 
	ORDER BY hi_count DESC 
	LIMIT 0,12 
  </select>
  
  
  <select id="selectArticlesCountByAccessright" parameterType="int" resultType="int">
    select count(*)
    from article_info
    where 1 = 1
    <if test="articleAccessright != null">
      and article_accessRight = #{articleAccessright,jdbcType=INTEGER}
    </if>


  </select>

  <select id="selectMonthArticlesByAccessRight" resultType="com.qqspace.vo.EChartsVO">
    select a.`year_month` as date,ifnull(b.count,0) as count
    from (
      SELECT DATE_FORMAT(CURDATE(), '%Y-%m') AS `year_month`
      UNION all SELECT DATE_FORMAT((CURDATE() - INTERVAL 1 MONTH), '%Y-%m') AS `year_month`
      UNION all SELECT DATE_FORMAT((CURDATE() - INTERVAL 2 MONTH), '%Y-%m') AS `year_month`
      UNION all SELECT DATE_FORMAT((CURDATE() - INTERVAL 3 MONTH), '%Y-%m') AS `year_month`
      UNION all SELECT DATE_FORMAT((CURDATE() - INTERVAL 4 MONTH), '%Y-%m') AS `year_month`
      UNION all SELECT DATE_FORMAT((CURDATE() - INTERVAL 5 MONTH), '%Y-%m') AS `year_month`
      ) a left join (
      select DATE_FORMAT(article_createDate,'%Y-%m') as time,COUNT(*) count
      from article_info b
      where 1=1
      <if test="articleAccessright != null">
        and b.article_accessRight = #{articleAccessright}
      </if>
      group by DATE_FORMAT(b.article_createDate,'%Y-%m')
      ) b on a.`year_month` = b.time order by date

  </select>
  <select id="selectAllCountByCondition"   resultType="int" >
    select  count(0)
    from	 article_info
    where 1=1
    <if test="userId != null">
      and article_userId = #{userId}
    </if>
    <if test="articleTitle != null">
      and article_title like concat('%',#{articleTitle},'%')
    </if>
    <if test="articleAuthor != null">
      and article_author like concat('%',#{articleAuthor},'%')
    </if>
    <if test="articleAccessright != null">
      and article_accessRight = #{articleAccessright}
    </if>
  </select>

  <select id="selectAllByCondition"    resultMap="ResultMapWithBLOBs">
    select  article_Id, article_title,article_userId, article_image, article_intro, article_author,
    article_createDate, article_accessRight, label_name
    from	 article_info
    LEFT JOIN label_info ON article_labelId = label_id
    where 1 =  1
    <if test="userId != null">
      and article_userId = #{userId}
    </if>
    <if test="articleTitle != null">
      and article_title like concat('%',#{articleTitle},'%')
    </if>
    <if test="articleAuthor != null">
      and article_author like concat('%',#{articleAuthor},'%')
    </if>
    <if test="articleAccessright != null">
      and article_accessRight = #{articleAccessright}
    </if>
    ORDER BY article_Id DESC
    LIMIT #{offset},#{size}
  </select>



  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 17 13:36:21 CST 2019.
    -->
    delete from article_info
    where article_Id = #{articleId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.qqspace.bean.Article" keyProperty="articleId" useGeneratedKeys="true">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 17 13:36:21 CST 2019.
    -->
    insert into article_info (article_Id, article_title, article_image, 
      article_intro, article_author, article_accessRight, 
      article_push, article_examine, article_labelId, 
      article_userId, article_createDate, article_content
      )
    values (#{articleId,jdbcType=INTEGER}, #{articleTitle,jdbcType=VARCHAR}, #{articleImage,jdbcType=VARCHAR}, 
      #{articleIntro,jdbcType=VARCHAR}, #{articleAuthor,jdbcType=VARCHAR}, #{articleAccessright,jdbcType=INTEGER}, 
      #{articlePush,jdbcType=INTEGER}, #{articleExamine,jdbcType=INTEGER}, #{articleLabelid,jdbcType=INTEGER}, 
      #{articleUserid,jdbcType=INTEGER}, #{articleCreatedate,jdbcType=TIMESTAMP}, #{articleContent,jdbcType=LONGVARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.qqspace.bean.Article" keyProperty="articleId" useGeneratedKeys="true">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 17 13:36:21 CST 2019.
    -->
    insert into article_info
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="articleId != null">
        article_Id,
      </if>
      <if test="articleTitle != null">
        article_title,
      </if>
      <if test="articleImage != null">
        article_image,
      </if>
      <if test="articleIntro != null">
        article_intro,
      </if>
      <if test="articleAuthor != null">
        article_author,
      </if>
      <if test="articleAccessright != null">
        article_accessRight,
      </if>
      <if test="articlePush != null">
        article_push,
      </if>
      <if test="articleExamine != null">
        article_examine,
      </if>
      <if test="articleLabelid != null">
        article_labelId,
      </if>
      <if test="articleUserid != null">
        article_userId,
      </if>
      <if test="articleCreatedate != null">
        article_createDate,
      </if>
      <if test="articleContent != null">
        article_content,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="articleId != null">
        #{articleId,jdbcType=INTEGER},
      </if>
      <if test="articleTitle != null">
        #{articleTitle,jdbcType=VARCHAR},
      </if>
      <if test="articleImage != null">
        #{articleImage,jdbcType=VARCHAR},
      </if>
      <if test="articleIntro != null">
        #{articleIntro,jdbcType=VARCHAR},
      </if>
      <if test="articleAuthor != null">
        #{articleAuthor,jdbcType=VARCHAR},
      </if>
      <if test="articleAccessright != null">
        #{articleAccessright,jdbcType=INTEGER},
      </if>
      <if test="articlePush != null">
        #{articlePush,jdbcType=INTEGER},
      </if>
      <if test="articleExamine != null">
        #{articleExamine,jdbcType=INTEGER},
      </if>
      <if test="articleLabelid != null">
        #{articleLabelid,jdbcType=INTEGER},
      </if>
      <if test="articleUserid != null">
        #{articleUserid,jdbcType=INTEGER},
      </if>
      <if test="articleCreatedate != null">
        #{articleCreatedate,jdbcType=TIMESTAMP},
      </if>
      <if test="articleContent != null">
        #{articleContent,jdbcType=LONGVARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.qqspace.bean.Article">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 17 13:36:21 CST 2019.
    -->
    update article_info
    <set>
      <if test="articleTitle != null">
        article_title = #{articleTitle,jdbcType=VARCHAR},
      </if>
      <if test="articleImage != null">
        article_image = #{articleImage,jdbcType=VARCHAR},
      </if>
      <if test="articleIntro != null">
        article_intro = #{articleIntro,jdbcType=VARCHAR},
      </if>
      <if test="articleAuthor != null">
        article_author = #{articleAuthor,jdbcType=VARCHAR},
      </if>
      <if test="articleAccessright != null">
        article_accessRight = #{articleAccessright,jdbcType=INTEGER},
      </if>
      <if test="articlePush != null">
        article_push = #{articlePush,jdbcType=INTEGER},
      </if>
      <if test="articleExamine != null">
        article_examine = #{articleExamine,jdbcType=INTEGER},
      </if>
      <if test="articleLabelid != null">
        article_labelId = #{articleLabelid,jdbcType=INTEGER},
      </if>
      <if test="articleUserid != null">
        article_userId = #{articleUserid,jdbcType=INTEGER},
      </if>
      <if test="articleCreatedate != null">
        article_createDate = #{articleCreatedate,jdbcType=TIMESTAMP},
      </if>
      <if test="articleContent != null">
        article_content = #{articleContent,jdbcType=LONGVARCHAR},
      </if>
    </set>
    where article_Id = #{articleId,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKeyWithBLOBs" parameterType="com.qqspace.bean.Article">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 17 13:36:21 CST 2019.
    -->
    update article_info
    set article_title = #{articleTitle,jdbcType=VARCHAR},
      article_image = #{articleImage,jdbcType=VARCHAR},
      article_intro = #{articleIntro,jdbcType=VARCHAR},
      article_author = #{articleAuthor,jdbcType=VARCHAR},
      article_accessRight = #{articleAccessright,jdbcType=INTEGER},
      article_push = #{articlePush,jdbcType=INTEGER},
      article_examine = #{articleExamine,jdbcType=INTEGER},
      article_labelId = #{articleLabelid,jdbcType=INTEGER},
      article_userId = #{articleUserid,jdbcType=INTEGER},
      article_createDate = #{articleCreatedate,jdbcType=TIMESTAMP},
      article_content = #{articleContent,jdbcType=LONGVARCHAR}
    where article_Id = #{articleId,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.qqspace.bean.Article">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 17 13:36:21 CST 2019.
    -->
    update article_info
    set article_title = #{articleTitle,jdbcType=VARCHAR},
      article_image = #{articleImage,jdbcType=VARCHAR},
      article_intro = #{articleIntro,jdbcType=VARCHAR},
      article_author = #{articleAuthor,jdbcType=VARCHAR},
      article_accessRight = #{articleAccessright,jdbcType=INTEGER},
      article_push = #{articlePush,jdbcType=INTEGER},
      article_examine = #{articleExamine,jdbcType=INTEGER},
      article_labelId = #{articleLabelid,jdbcType=INTEGER},
      article_userId = #{articleUserid,jdbcType=INTEGER},
      article_createDate = #{articleCreatedate,jdbcType=TIMESTAMP}
    where article_Id = #{articleId,jdbcType=INTEGER}
  </update>
</mapper>